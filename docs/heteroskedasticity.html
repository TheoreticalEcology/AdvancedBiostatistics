<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Heteroskedasticity and Grouped Data (Random Effects) | Advanced Regression Models with R</title>
  <meta name="description" content="Advanced Regression with R" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Heteroskedasticity and Grouped Data (Random Effects) | Advanced Regression Models with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Advanced Regression with R" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Heteroskedasticity and Grouped Data (Random Effects) | Advanced Regression Models with R" />
  
  <meta name="twitter:description" content="Advanced Regression with R" />
  

<meta name="author" content="Florian Hartig" />


<meta name="date" content="2022-06-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="understanding_linear_regression.html"/>
<link rel="next" href="GLMMs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="reminder.html"><a href="reminder.html"><i class="fa fa-check"></i><b>2</b> Reminder: R Basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reminder.html"><a href="reminder.html#your-r-system"><i class="fa fa-check"></i><b>2.1</b> Your R System</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="reminder.html"><a href="reminder.html#installing-libraries"><i class="fa fa-check"></i><b>2.1.1</b> Installing Libraries</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="reminder.html"><a href="reminder.html#representing-data-in-r"><i class="fa fa-check"></i><b>2.2</b> Representing Data in R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="reminder.html"><a href="reminder.html#exploring-data-structures"><i class="fa fa-check"></i><b>2.2.1</b> Exploring Data Structures</a></li>
<li class="chapter" data-level="2.2.2" data-path="reminder.html"><a href="reminder.html#dynamic-typing"><i class="fa fa-check"></i><b>2.2.2</b> Dynamic Typing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reminder.html"><a href="reminder.html#data-selection-slicing-and-subsetting"><i class="fa fa-check"></i><b>2.3</b> Data Selection, Slicing and Subsetting</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="reminder.html"><a href="reminder.html#subsetting-and-slicing-for-single-data-types"><i class="fa fa-check"></i><b>2.3.1</b> Subsetting and Slicing for Single Data Types</a></li>
<li class="chapter" data-level="2.3.2" data-path="reminder.html"><a href="reminder.html#logic-and-slicing"><i class="fa fa-check"></i><b>2.3.2</b> Logic and Slicing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="reminder.html"><a href="reminder.html#applying-functions-and-aggregates-across-a-data-set"><i class="fa fa-check"></i><b>2.4</b> Applying Functions and Aggregates Across a Data Set</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="reminder.html"><a href="reminder.html#functions"><i class="fa fa-check"></i><b>2.4.1</b> Functions</a></li>
<li class="chapter" data-level="2.4.2" data-path="reminder.html"><a href="reminder.html#the-apply-function"><i class="fa fa-check"></i><b>2.4.2</b> The apply() Function</a></li>
<li class="chapter" data-level="2.4.3" data-path="reminder.html"><a href="reminder.html#the-aggregate-function"><i class="fa fa-check"></i><b>2.4.3</b> The aggregate() Function</a></li>
<li class="chapter" data-level="2.4.4" data-path="reminder.html"><a href="reminder.html#for-loops"><i class="fa fa-check"></i><b>2.4.4</b> For loops</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reminder.html"><a href="reminder.html#plotting"><i class="fa fa-check"></i><b>2.5</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html"><i class="fa fa-check"></i><b>3</b> Understanding Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#fitting-and-interpreting-the-regression"><i class="fa fa-check"></i><b>3.1.1</b> Fitting and Interpreting the Regression</a></li>
<li class="chapter" data-level="3.1.2" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#centering-and-scaling-of-predictors"><i class="fa fa-check"></i><b>3.1.2</b> Centering and Scaling of Predictors</a></li>
<li class="chapter" data-level="3.1.3" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#residual-checks"><i class="fa fa-check"></i><b>3.1.3</b> Residual Checks</a></li>
<li class="chapter" data-level="3.1.4" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#categorical-predictors"><i class="fa fa-check"></i><b>3.1.4</b> Categorical Predictors</a></li>
<li class="chapter" data-level="3.1.5" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#plantTrait1"><i class="fa fa-check"></i><b>3.1.5</b> Exercise: Global Plant Trait Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#multiple-regression"><i class="fa fa-check"></i><b>3.2</b> Multiple Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#understanding-the-effect-of-collinearity"><i class="fa fa-check"></i><b>3.2.1</b> Understanding the Effect of Collinearity</a></li>
<li class="chapter" data-level="3.2.2" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#scaling-variables-in-the-multiple-regression"><i class="fa fa-check"></i><b>3.2.2</b> Scaling Variables in the Multiple Regression</a></li>
<li class="chapter" data-level="3.2.3" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#anova-for-multiple-regression"><i class="fa fa-check"></i><b>3.2.3</b> ANOVA for Multiple Regression</a></li>
<li class="chapter" data-level="3.2.4" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#interactions"><i class="fa fa-check"></i><b>3.2.4</b> Interactions</a></li>
<li class="chapter" data-level="3.2.5" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#plantTrait2"><i class="fa fa-check"></i><b>3.2.5</b> Exercise: Global Plant Trait Analysis #2</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#model-choice-and-causal-inference"><i class="fa fa-check"></i><b>3.3</b> Model Choice and Causal Inference</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#the-bias-variance-trade-off"><i class="fa fa-check"></i><b>3.3.1</b> The Bias-Variance Trade-off</a></li>
<li class="chapter" data-level="3.3.2" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#causal-inference"><i class="fa fa-check"></i><b>3.3.2</b> Causal Inference</a></li>
<li class="chapter" data-level="3.3.3" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#model-selection-methods"><i class="fa fa-check"></i><b>3.3.3</b> Model Selection Methods</a></li>
<li class="chapter" data-level="3.3.4" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#pHacking"><i class="fa fa-check"></i><b>3.3.4</b> P-hacking</a></li>
<li class="chapter" data-level="3.3.5" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#problems-of-stepwise-model-selection"><i class="fa fa-check"></i><b>3.3.5</b> Problems of Stepwise Model Selection</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#case-studies"><i class="fa fa-check"></i><b>3.4</b> Case studies</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#exercise-global-plant-trait-analysis-3"><i class="fa fa-check"></i><b>3.4.1</b> Exercise: Global Plant Trait Analysis #3</a></li>
<li class="chapter" data-level="3.4.2" data-path="understanding_linear_regression.html"><a href="understanding_linear_regression.html#case-study-life-satisfaction"><i class="fa fa-check"></i><b>3.4.2</b> Case study: Life satisfaction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html"><i class="fa fa-check"></i><b>4</b> Heteroskedasticity and Grouped Data (Random Effects)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#adjusting-the-functional-form"><i class="fa fa-check"></i><b>4.1</b> Adjusting the Functional Form</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#changing-the-regression-formular"><i class="fa fa-check"></i><b>4.1.1</b> Changing the regression formular</a></li>
<li class="chapter" data-level="4.1.2" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#generalized-additive-models-gams"><i class="fa fa-check"></i><b>4.1.2</b> Generalized additive models (GAMs)</a></li>
<li class="chapter" data-level="4.1.3" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#exercise-functional-form"><i class="fa fa-check"></i><b>4.1.3</b> Exercise functional form</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#modelling-variance-terms"><i class="fa fa-check"></i><b>4.2</b> Modelling Variance Terms</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#transformation"><i class="fa fa-check"></i><b>4.2.1</b> Transformation</a></li>
<li class="chapter" data-level="4.2.2" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#model-the-variance"><i class="fa fa-check"></i><b>4.2.2</b> Model the variance</a></li>
<li class="chapter" data-level="4.2.3" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#exercise-variance-modelling"><i class="fa fa-check"></i><b>4.2.3</b> Exercise variance modelling</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#non-normality-and-outliers"><i class="fa fa-check"></i><b>4.3</b> Non-normality and Outliers</a></li>
<li class="chapter" data-level="4.4" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#random-and-mixed-effects---motivation"><i class="fa fa-check"></i><b>4.4</b> Random and Mixed Effects - Motivation</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#fitting-random-effects-models"><i class="fa fa-check"></i><b>4.4.1</b> Fitting Random Effects Models</a></li>
<li class="chapter" data-level="4.4.2" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#problems-with-mixed-models"><i class="fa fa-check"></i><b>4.4.2</b> Problems With Mixed Models</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#case-studies-1"><i class="fa fa-check"></i><b>4.5</b> Case studies</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#case-study-1-college-student-performance-over-time"><i class="fa fa-check"></i><b>4.5.1</b> Case Study 1: College Student Performance Over Time</a></li>
<li class="chapter" data-level="4.5.2" data-path="heteroskedasticity.html"><a href="heteroskedasticity.html#case-study-2---honeybee-data"><i class="fa fa-check"></i><b>4.5.2</b> Case Study 2 - Honeybee Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="GLMMs.html"><a href="GLMMs.html"><i class="fa fa-check"></i><b>5</b> GLMMs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="GLMMs.html"><a href="GLMMs.html#basics"><i class="fa fa-check"></i><b>5.1</b> Basics</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="GLMMs.html"><a href="GLMMs.html#a-binomial-example"><i class="fa fa-check"></i><b>5.1.1</b> A Binomial Example</a></li>
<li class="chapter" data-level="5.1.2" data-path="GLMMs.html"><a href="GLMMs.html#a-poisson-example"><i class="fa fa-check"></i><b>5.1.2</b> A Poisson Example</a></li>
<li class="chapter" data-level="5.1.3" data-path="GLMMs.html"><a href="GLMMs.html#example---elk-data"><i class="fa fa-check"></i><b>5.1.3</b> Example - Elk Data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="GLMMs.html"><a href="GLMMs.html#dispersion-problems-in-glms"><i class="fa fa-check"></i><b>5.2</b> Dispersion Problems in GLMs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="GLMMs.html"><a href="GLMMs.html#heteroskedasticity-in-glmms"><i class="fa fa-check"></i><b>5.2.1</b> Heteroskedasticity in GLMMs</a></li>
<li class="chapter" data-level="5.2.2" data-path="GLMMs.html"><a href="GLMMs.html#zero-inflation"><i class="fa fa-check"></i><b>5.2.2</b> Zero-inflation</a></li>
<li class="chapter" data-level="5.2.3" data-path="GLMMs.html"><a href="GLMMs.html#p-hacking-link-collection"><i class="fa fa-check"></i><b>5.2.3</b> P-hacking Link Collection</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="GLMMs.html"><a href="GLMMs.html#protocol"><i class="fa fa-check"></i><b>5.3</b> Case Studies</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="GLMMs.html"><a href="GLMMs.html#owls"><i class="fa fa-check"></i><b>5.3.1</b> Owls</a></li>
<li class="chapter" data-level="5.3.2" data-path="GLMMs.html"><a href="GLMMs.html#hurricanes"><i class="fa fa-check"></i><b>5.3.2</b> Hurricanes</a></li>
<li class="chapter" data-level="5.3.3" data-path="GLMMs.html"><a href="GLMMs.html#researchers-degrees-of-freedom-skin-color-and-red-cards"><i class="fa fa-check"></i><b>5.3.3</b> Researchers Degrees of Freedom — Skin Color and Red Cards</a></li>
<li class="chapter" data-level="5.3.4" data-path="GLMMs.html"><a href="GLMMs.html#marmots"><i class="fa fa-check"></i><b>5.3.4</b> Marmots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>6</b> Correlation structures</a>
<ul>
<li class="chapter" data-level="6.1" data-path="correlation.html"><a href="correlation.html#general-idea"><i class="fa fa-check"></i><b>6.1</b> General Idea</a></li>
<li class="chapter" data-level="6.2" data-path="correlation.html"><a href="correlation.html#temporal-and-spatial-correlation-structures"><i class="fa fa-check"></i><b>6.2</b> Temporal and Spatial Correlation Structures</a></li>
<li class="chapter" data-level="6.3" data-path="correlation.html"><a href="correlation.html#phylogenetic-structures-pgls"><i class="fa fa-check"></i><b>6.3</b> Phylogenetic Structures (PGLS)</a></li>
<li class="chapter" data-level="6.4" data-path="correlation.html"><a href="correlation.html#exercices"><i class="fa fa-check"></i><b>6.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced_topics.html"><a href="advanced_topics.html"><i class="fa fa-check"></i><b>7</b> Summary and advanced topics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="advanced_topics.html"><a href="advanced_topics.html#reminder-modelling-strategy"><i class="fa fa-check"></i><b>7.1</b> Reminder: Modelling Strategy</a></li>
<li class="chapter" data-level="7.2" data-path="advanced_topics.html"><a href="advanced_topics.html#thoughts-about-the-analysis-pipeline"><i class="fa fa-check"></i><b>7.2</b> Thoughts About the Analysis Pipeline</a></li>
<li class="chapter" data-level="7.3" data-path="advanced_topics.html"><a href="advanced_topics.html#nonparametric-estimators"><i class="fa fa-check"></i><b>7.3</b> Nonparametric estimators</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="advanced_topics.html"><a href="advanced_topics.html#the-bootstrap"><i class="fa fa-check"></i><b>7.3.1</b> The bootstrap</a></li>
<li class="chapter" data-level="7.3.2" data-path="advanced_topics.html"><a href="advanced_topics.html#cross-validation"><i class="fa fa-check"></i><b>7.3.2</b> Cross-validation</a></li>
<li class="chapter" data-level="7.3.3" data-path="advanced_topics.html"><a href="advanced_topics.html#null-models"><i class="fa fa-check"></i><b>7.3.3</b> Null Models</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="advanced_topics.html"><a href="advanced_topics.html#structural-equation-models-sems"><i class="fa fa-check"></i><b>7.4</b> Structural Equation Models (SEMs)</a></li>
<li class="chapter" data-level="7.5" data-path="advanced_topics.html"><a href="advanced_topics.html#intro-bayes"><i class="fa fa-check"></i><b>7.5</b> Intro Bayes</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Regression Models with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="heteroskedasticity" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Heteroskedasticity and Grouped Data (Random Effects)<a href="heteroskedasticity.html#heteroskedasticity" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Put this here (right after the first markdown headline) and only here for each document! -->
<script src="./scripts/multipleChoice.js"></script>
<p>In the last chapter, we have discussed how to set up a basic lm, including the selection of predictors according to the purpose of the modelling (prediction, causal analysis). Remember in particular that for a causal analysis, which I consider the standard case in the scineces, first, think about the problem and your question an decide on a base structure. Ideally, you do this by:</p>
<ul>
<li>Writing down your scientific questions (e.g. Ozone ~ Wind)</li>
<li>Then add confounders / mediators if needed.</li>
<li>Remember to make a difference between variables controlled for confounding, and other confounders (which are typically not controlled for confounding). We may have to use some model selection, but in fact with a good analysis plan this is rarely necessary for a causal analysis.</li>
</ul>
<p>After having arrived at such a base structure, we will have to check if the model is appropriate for the analysis. Yesterday, we already discussed about residual checks and we discussed that the 4 standard residual plots check for 4 different problems.</p>
<ul>
<li>Residuals vs Fitted = Functional relationship.</li>
<li>Normal Q-Q = Normality of residuals.</li>
<li>Scale - Location = Variance homogeneity.</li>
<li>Residuals vs Leverage = Should we worry about certain outliers?</li>
</ul>
<p>Here an example for a linear regression of Ozone against Wind:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="heteroskedasticity.html#cb256-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp , <span class="at">data =</span> airquality)</span>
<span id="cb256-2"><a href="heteroskedasticity.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Ozone <span class="sc">~</span> Temp, <span class="at">data =</span> airquality)</span>
<span id="cb256-3"><a href="heteroskedasticity.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk2-1.png" width="672" /></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="heteroskedasticity.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb257-2"><a href="heteroskedasticity.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk2-2.png" width="672" /></p>
<p>The usual strategy now is to</p>
<ol style="list-style-type: decimal">
<li>First get the functional relationship right, so that the model correctly describe the mean</li>
<li>Then adjust the model assumptions regardigng distribution, variance and outliers.</li>
</ol>
<p>We will go through these steps now, and on the way also learn how to deal with heteroskedasticity, outliers, weird distributions and grouped data (random or mixed models).</p>
<div id="adjusting-the-functional-form" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Adjusting the Functional Form<a href="heteroskedasticity.html#adjusting-the-functional-form" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the residual ~ fitted plot above, we can clearly see a pattern, which means that our model has a systematic misfit. Note that in a multiple regression, you should also check res ~ predictor for all predictors, because patterns of misfit often show up more clearly when plotted against the single predictors.</p>
<p>What should we do if we see a pattern? Here a few strategies that you might want to consider:</p>
<div id="changing-the-regression-formular" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Changing the regression formular<a href="heteroskedasticity.html#changing-the-regression-formular" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The easiest strategy is to add complexity to the polynomial, e.g. quadratic terms, interactions etc.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="heteroskedasticity.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb258-2"><a href="heteroskedasticity.html#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="heteroskedasticity.html#cb258-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Wind <span class="sc">*</span> Temp <span class="sc">+</span> <span class="fu">I</span>(Wind<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(Temp<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> airquality)</span>
<span id="cb258-4"><a href="heteroskedasticity.html#cb258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-5"><a href="heteroskedasticity.html#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(fit, <span class="at">partial.residuals =</span> T), <span class="at">selection =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk3-1.png" width="672" /></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="heteroskedasticity.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(fit, <span class="at">partial.residuals =</span> T), <span class="at">selection =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk3-2.png" width="672" /></p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="heteroskedasticity.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(fit, <span class="at">partial.residuals =</span> T), <span class="at">selection =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk3-3.png" width="672" /></p>
<p>and see if the residuals are getting better. To avoid doing this totally randomly, it may be useful to plot residuals against individual predictors by hand!</p>
</div>
<div id="generalized-additive-models-gams" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Generalized additive models (GAMs)<a href="heteroskedasticity.html#generalized-additive-models-gams" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another options are GAMs = Generalized Additive Models. The idea is to fit a smooth function to data, to automatically find the “right” functional form. The smoothness of the function is automatically optimized.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="heteroskedasticity.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb261-2"><a href="heteroskedasticity.html#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="heteroskedasticity.html#cb261-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">gam</span>(Ozone <span class="sc">~</span> <span class="fu">s</span>(Wind) <span class="sc">+</span> <span class="fu">s</span>(Temp) <span class="sc">+</span> <span class="fu">s</span>(Solar.R) , <span class="at">data =</span> airquality)</span>
<span id="cb261-4"><a href="heteroskedasticity.html#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Ozone ~ s(Wind) + s(Temp) + s(Solar.R)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   42.099      1.663   25.32   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##              edf Ref.df      F p-value    
## s(Wind)    2.910  3.657 13.695 &lt; 2e-16 ***
## s(Temp)    3.833  4.753 11.613 &lt; 2e-16 ***
## s(Solar.R) 2.760  3.447  3.967 0.00858 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.723   Deviance explained = 74.7%
## GCV =  338.9  Scale est. = 306.83    n = 111</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="heteroskedasticity.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># allEffects doesn&#39;t work here.</span></span>
<span id="cb263-2"><a href="heteroskedasticity.html#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">pages =</span> <span class="dv">0</span>, <span class="at">residuals =</span> T, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">lwd =</span> <span class="fl">1.8</span>, <span class="at">cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb263-3"><a href="heteroskedasticity.html#cb263-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;red&quot;</span>, <span class="fu">length</span>(fit<span class="sc">$</span>residuals))))</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk4-1.png" width="672" /><img src="_main_files/figure-html/chunk_chapter4_chunk4-2.png" width="672" /><img src="_main_files/figure-html/chunk_chapter4_chunk4-3.png" width="672" /></p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="heteroskedasticity.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit)</span></code></pre></div>
<pre><code>## [1] 962.596</code></pre>
<p>Comparison to normal <code class="sourceCode r"><span class="fu">lm</span>()</code>:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="heteroskedasticity.html#cb266-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Wind <span class="sc">+</span> Temp <span class="sc">+</span> Solar.R , <span class="at">data =</span> airquality)</span>
<span id="cb266-2"><a href="heteroskedasticity.html#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit)</span></code></pre></div>
<pre><code>## [1] 998.7171</code></pre>
<p>Spline interaction is called a <strong>tensor spline</strong>:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="heteroskedasticity.html#cb268-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">gam</span>(Ozone <span class="sc">~</span> <span class="fu">te</span>(Wind, Temp) <span class="sc">+</span> <span class="fu">s</span>(Solar.R) , <span class="at">data =</span> airquality)</span>
<span id="cb268-2"><a href="heteroskedasticity.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Ozone ~ te(Wind, Temp) + s(Solar.R)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   42.099      1.403      30   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                  edf Ref.df      F p-value    
## te(Wind,Temp) 13.176  14.87 22.151  &lt;2e-16 ***
## s(Solar.R)     2.822   3.52  3.177  0.0237 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.803   Deviance explained = 83.1%
## GCV = 258.06  Scale est. = 218.54    n = 111</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="heteroskedasticity.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">pages =</span> <span class="dv">0</span>, <span class="at">residuals =</span> T, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">lwd =</span> <span class="fl">1.9</span>, <span class="at">cex =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk6-1.png" width="672" /><img src="_main_files/figure-html/chunk_chapter4_chunk6-2.png" width="672" /></p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="heteroskedasticity.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit)</span></code></pre></div>
<pre><code>## [1] 930.5047</code></pre>
<p>GAMs are particularly useful for confounders. If you have confounders, you usually don’t care that the fitted relationship is a bit hard to interpret, you just want the confounder effect to be removed. So, if you want to fit the causal relationship between Ozone ~ Wind, account for the other variables, a good strategy might be:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="heteroskedasticity.html#cb273-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">gam</span>(Ozone <span class="sc">~</span> Wind <span class="sc">+</span> <span class="fu">s</span>(Temp) <span class="sc">+</span> <span class="fu">s</span>(Solar.R) , <span class="at">data =</span> airquality)</span>
<span id="cb273-2"><a href="heteroskedasticity.html#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Ozone ~ Wind + s(Temp) + s(Solar.R)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  72.2181     6.3166  11.433  &lt; 2e-16 ***
## Wind         -3.0302     0.6082  -4.982 2.55e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##              edf Ref.df      F p-value    
## s(Temp)    3.358  4.184 14.972  &lt;2e-16 ***
## s(Solar.R) 2.843  3.551  3.721  0.0115 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.664   Deviance explained = 68.6%
## GCV = 402.11  Scale est. = 372.4     n = 111</code></pre>
<p>In this way, you still get a nicely interpretable linear effect for Wind, but you don’t have to worry about the functional form of the other predictors.</p>
</div>
<div id="exercise-functional-form" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Exercise functional form<a href="heteroskedasticity.html#exercise-functional-form" class="anchor-section" aria-label="Anchor link to header"></a></h3>
  <hr/>
  <strong><span style="color: #0011AA; font-size:25px;">Task</span></strong><br/>
<p>Assume our base model is</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="heteroskedasticity.html#cb275-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Wind <span class="sc">+</span> Temp <span class="sc">+</span> Solar.R, <span class="at">data =</span> airquality)</span></code></pre></div>
<p>and we are mainly interested in the effect of wind (Temp - Solar.R are added as confounders).</p>
<p>Adjust the functional form until the mean is fitted well!</p>
  <details>
    <summary>
      <strong><span style="color: #0011AA; font-size:25px;">Solution</span></strong>
    </summary>
    <p>
    </p>
  </details>
  <br/><hr/>
</div>
</div>
<div id="modelling-variance-terms" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Modelling Variance Terms<a href="heteroskedasticity.html#modelling-variance-terms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After we have fixed the functional form, we want to look at the distribution of the residuals. We said yesterday that you can try to get them more normal by applying an appropriate transformation, e.g. the logarithm or square root. Without transformation, we often find that data shows heteroskedasticity, i.e. the residual variance changes with some predictor or the mean estimate (see also Scale - Location plot). Maybe your experimental data looks like this:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="heteroskedasticity.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">125</span>)</span>
<span id="cb276-2"><a href="heteroskedasticity.html#cb276-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-3"><a href="heteroskedasticity.html#cb276-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="at">each =</span> <span class="dv">15</span>)))</span>
<span id="cb276-4"><a href="heteroskedasticity.html#cb276-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>observation <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">2</span> ,<span class="dv">4</span>)[<span class="fu">as.numeric</span>(data<span class="sc">$</span>treatment)] <span class="sc">+</span></span>
<span id="cb276-5"><a href="heteroskedasticity.html#cb276-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>( <span class="fu">length</span>(data<span class="sc">$</span>treatment), <span class="at">sd =</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>treatment)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb276-6"><a href="heteroskedasticity.html#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(observation <span class="sc">~</span> treatment, <span class="at">data =</span> data)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk8-1.png" width="672" /></p>
<p>Especially p-values and confidence intervals of <code class="sourceCode r"><span class="fu">lm</span>()</code> and ANOVA can react quite strongly to such differences in residual variation. So, running a standard <code class="sourceCode r"><span class="fu">lm</span>()</code> / ANOVA on this data is not a good idea - in this case, we see that all regression effects are not significant, as is the ANOVA, suggesting that there is no difference between groups.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="heteroskedasticity.html#cb277-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(observation <span class="sc">~</span> treatment, <span class="at">data =</span> data)</span>
<span id="cb277-2"><a href="heteroskedasticity.html#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = observation ~ treatment, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -17.2897  -1.0514   0.3531   2.4465  19.8602 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    7.043      1.731   4.069 0.000204 ***
## treatmentB    -3.925      2.448  -1.603 0.116338    
## treatmentC    -1.302      2.448  -0.532 0.597601    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.704 on 42 degrees of freedom
## Multiple R-squared:  0.05973,    Adjusted R-squared:  0.01495 
## F-statistic: 1.334 on 2 and 42 DF,  p-value: 0.2744</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="heteroskedasticity.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(fit))</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## treatment    2  119.9   59.95   1.334  0.274
## Residuals   42 1887.6   44.94</code></pre>
<p>So, what can we do?</p>
<div id="transformation" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Transformation<a href="heteroskedasticity.html#transformation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One option is to search for a transformation of the response that improves the problem - If heteroskedasticity correlates with the mean value, one can typically decrease it by some sqrt or log transformation, but often difficult, because this may also conflict with keeping the distribution normal.</p>
</div>
<div id="model-the-variance" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Model the variance<a href="heteroskedasticity.html#model-the-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The second, more general option, is to model the variance - Modelling the variance to fit a model where the variance is not fixed. The basic option in R is <code class="sourceCode r">nlme<span class="sc">::</span>gls</code>. GLS = <em>Generalized Least Squares</em>. In this function, you can specify a dependency of the residual variance on a predictor or the response. See options via <code class="sourceCode r">?varFunc</code>. In our case, we will use the varIdent option, which allows to specify a different variance per treatment.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="heteroskedasticity.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb281-2"><a href="heteroskedasticity.html#cb281-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-3"><a href="heteroskedasticity.html#cb281-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">gls</span>(observation <span class="sc">~</span> treatment, <span class="at">data =</span> data, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> treatment))</span>
<span id="cb281-4"><a href="heteroskedasticity.html#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: observation ~ treatment 
##   Data: data 
##        AIC      BIC    logLik
##   243.9258 254.3519 -115.9629
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | treatment 
##  Parameter estimates:
##         A         B         C 
##  1.000000  4.714512 11.821868 
## 
## Coefficients:
##                 Value Std.Error   t-value p-value
## (Intercept)  7.042667 0.2348387 29.989388  0.0000
## treatmentB  -3.925011 1.1317816 -3.467994  0.0012
## treatmentC  -1.302030 2.7861462 -0.467323  0.6427
## 
##  Correlation: 
##            (Intr) trtmnB
## treatmentB -0.207       
## treatmentC -0.084  0.017
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -2.4587934 -0.6241702  0.1687727  0.6524558  1.9480169 
## 
## Residual standard error: 0.9095262 
## Degrees of freedom: 45 total; 42 residual</code></pre>
<p>If you check the ANOVA, also the ANOVA is significant!</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="heteroskedasticity.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit)</span></code></pre></div>
<pre><code>## Denom. DF: 42 
##             numDF  F-value p-value
## (Intercept)     1 899.3761  &lt;.0001
## treatment       2   6.0962  0.0047</code></pre>
<p>The second option for modeling variances is to use the <code>glmmTMB</code>.{R} package, which we will use quite frequently this week. Here, you can specify an extra regression formula for the dispersion (= residual variance). If we fit this:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="heteroskedasticity.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb285-2"><a href="heteroskedasticity.html#cb285-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-3"><a href="heteroskedasticity.html#cb285-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glmmTMB</span>(observation <span class="sc">~</span> treatment, <span class="at">data =</span> data, <span class="at">dispformula =</span> <span class="sc">~</span> treatment)</span></code></pre></div>
<p>We get 2 regression tables as outputs - one for the effects, and one for the dispersion (= residual variance). We see, as expected, that the dispersion is higher in groups B and C compared to A. An advantage over gls is that we get confidence intervals and p-values for these differences on top!</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="heteroskedasticity.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>##  Family: gaussian  ( identity )
## Formula:          observation ~ treatment
## Dispersion:                   ~treatment
## Data: data
## 
##      AIC      BIC   logLik deviance df.resid 
##    248.7    259.5   -118.3    236.7       39 
## 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   7.0427     0.2269  31.042  &lt; 2e-16 ***
## treatmentB   -3.9250     1.0934  -3.590 0.000331 ***
## treatmentC   -1.3020     2.6917  -0.484 0.628582    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Dispersion model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -0.2587     0.3651  -0.708    0.479    
## treatmentB    3.1013     0.5164   6.006 1.91e-09 ***
## treatmentC    4.9399     0.5164   9.566  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="exercise-variance-modelling" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Exercise variance modelling<a href="heteroskedasticity.html#exercise-variance-modelling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Take this plot of Ozone ~ Solar.R using the airquality data. Clearly there is heteroskedasticity in the relationship:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="heteroskedasticity.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Ozone <span class="sc">~</span> Solar.R, <span class="at">data =</span> airquality)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk14-1.png" width="672" /></p>
<p>We can also see this when we fit the regression model:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="heteroskedasticity.html#cb289-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Solar.R, <span class="at">data =</span> airquality)</span>
<span id="cb289-2"><a href="heteroskedasticity.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb289-3"><a href="heteroskedasticity.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk15-1.png" width="672" /></p>
  <hr/>
  <strong><span style="color: #0011AA; font-size:25px;">Task</span></strong><br/>
<p>We could of course consider other predictors, but let’s say we want to fit this model specifically</p>
<ol style="list-style-type: decimal">
<li>Try to get the variance stable with a transformation.</li>
<li>Use the <code class="sourceCode r">gls</code> function (package <code class="sourceCode r">nlme</code>) with the untransformed response to make the variance dependent on Solar.R. Hint: Read in <code>corClasses</code>.{R} and decide how to model this.</li>
<li>Use <code>glmmTMB</code>.{R} to model heteroskedasticity.</li>
</ol>
  <details>
    <summary>
      <strong><span style="color: #0011AA; font-size:25px;">Solution</span></strong>
    </summary>
    <p>
    </p>
  </details>
  <br/><hr/>
</div>
</div>
<div id="non-normality-and-outliers" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Non-normality and Outliers<a href="heteroskedasticity.html#non-normality-and-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What can we do if, after accounting for the functional relationship, response transformation and variance modelling, residual diagnostic 2 shows non-normality, in particular strong outliers? Here simulated example data with strong outliers / deviations from normality:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="heteroskedasticity.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb290-2"><a href="heteroskedasticity.html#cb290-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-3"><a href="heteroskedasticity.html#cb290-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb290-4"><a href="heteroskedasticity.html#cb290-4" aria-hidden="true" tabindex="-1"></a>concentration <span class="ot">=</span> <span class="fu">runif</span>(n, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb290-5"><a href="heteroskedasticity.html#cb290-5" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> concentration <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb290-6"><a href="heteroskedasticity.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.05</span>) <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">6</span><span class="sc">*</span>concentration, <span class="at">sd =</span> <span class="dv">6</span>)</span>
<span id="cb290-7"><a href="heteroskedasticity.html#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(growth <span class="sc">~</span> concentration)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk16-1.png" width="672" /></p>
<p>Fitting the model, we see that the distribution is to wide:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="heteroskedasticity.html#cb291-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(growth <span class="sc">~</span> concentration)</span>
<span id="cb291-2"><a href="heteroskedasticity.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb291-3"><a href="heteroskedasticity.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk17-1.png" width="672" /></p>
<p>What can we do to deal with such distributional problems and outliers?</p>
<ul>
<li><strong>Removing</strong> - Bad option, hard to defend, reviewers don’t like this - if at all, better show robustness with and without outlier, but result is sometimes not robust.</li>
<li><strong>Change the distribution</strong> - Fit a model with a different distribution, i.e. GLM or other. -&gt; We will do this on Wednesday.</li>
<li><strong>Robust regressions</strong>.</li>
<li><strong>Quantile regression</strong> - A special type of regression that does not assume a particular residual distribution.</li>
</ul>
<p><strong><em>Change distribution</em></strong></p>
<p>If we want to change the distribution, we have to go to a GLM, see Wednesday.</p>
<p><strong><em>Robust regression</em></strong></p>
<p>Robust methods generally refer to methods that are robust to violation of assumptions, e.g. outliers. More specifically, standard robust regressions typically downweight datap oints that have a too high influence on the fit. See <a href="https://cran.r-project.org/web/views/Robust.html" target="_blank" rel="noopener">https://cran.r-project.org/web/views/Robust.html</a> for a list of robust packages in R.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="heteroskedasticity.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the classic method.</span></span>
<span id="cb292-2"><a href="heteroskedasticity.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb292-3"><a href="heteroskedasticity.html#cb292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-4"><a href="heteroskedasticity.html#cb292-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">rlm</span>(growth <span class="sc">~</span> concentration) </span>
<span id="cb292-5"><a href="heteroskedasticity.html#cb292-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call: rlm(formula = growth ~ concentration)
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.1986 -0.3724  0.0377  0.3391  7.0902 
## 
## Coefficients:
##               Value   Std. Error t value
## (Intercept)   -0.0978  0.0594    -1.6453
## concentration  2.0724  0.1048    19.7721
## 
## Residual standard error: 0.534 on 98 degrees of freedom</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="heteroskedasticity.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No p-values and not sure if we can trust the confidence intervals.</span></span>
<span id="cb294-2"><a href="heteroskedasticity.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Would need to boostrap by hand!</span></span>
<span id="cb294-3"><a href="heteroskedasticity.html#cb294-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-4"><a href="heteroskedasticity.html#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This is another option that gives us p-values directly.</span></span>
<span id="cb294-5"><a href="heteroskedasticity.html#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(robustbase)</span></code></pre></div>
<pre><code>## Warning: package &#39;robustbase&#39; was built under R version 4.1.1</code></pre>
<pre><code>## 
## Attaching package: &#39;robustbase&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:survival&#39;:
## 
##     heart</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="heteroskedasticity.html#cb298-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lmrob</span>(growth <span class="sc">~</span> concentration) </span>
<span id="cb298-2"><a href="heteroskedasticity.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lmrob(formula = growth ~ concentration)
##  \--&gt; method = &quot;MM&quot;
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.2877 -0.4311 -0.0654  0.2788  7.0384 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -0.04448    0.05160  -0.862    0.391    
## concentration  2.00588    0.08731  22.974   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Robust residual standard error: 0.5549 
## Multiple R-squared:  0.8431, Adjusted R-squared:  0.8415 
## Convergence in 7 IRWLS iterations
## 
## Robustness weights: 
##  9 observations c(27,40,47,52,56,76,80,91,100)
##   are outliers with |weight| = 0 ( &lt; 0.001); 
##  5 weights are ~= 1. The remaining 86 ones are summarized as
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.6673  0.9015  0.9703  0.9318  0.9914  0.9989 
## Algorithmic parameters: 
##        tuning.chi                bb        tuning.psi        refine.tol 
##         1.548e+00         5.000e-01         4.685e+00         1.000e-07 
##           rel.tol         scale.tol         solve.tol       eps.outlier 
##         1.000e-07         1.000e-10         1.000e-07         1.000e-03 
##             eps.x warn.limit.reject warn.limit.meanrw 
##         1.819e-12         5.000e-01         5.000e-01 
##      nResample         max.it       best.r.s       k.fast.s          k.max 
##            500             50              2              1            200 
##    maxit.scale      trace.lev            mts     compute.rd fast.s.large.n 
##            200              0           1000              0           2000 
##                   psi           subsampling                   cov 
##            &quot;bisquare&quot;         &quot;nonsingular&quot;         &quot;.vcov.avar1&quot; 
## compute.outlier.stats 
##                  &quot;SM&quot; 
## seed : int(0)</code></pre>
<p><strong><em>Quantile regression</em></strong></p>
<p>Quantile regressions don’t fit a line with an error spreading around it, but try to fit a quantile (e.g. the 0.5 quantile, the median) regardless of the distribution. Thus, they work even if the usual assumptions don’t hold.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="heteroskedasticity.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantreg)</span>
<span id="cb300-2"><a href="heteroskedasticity.html#cb300-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-3"><a href="heteroskedasticity.html#cb300-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">rq</span>(growth <span class="sc">~</span> concentration, .<span class="dv">5</span>) </span>
<span id="cb300-4"><a href="heteroskedasticity.html#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call: rq(formula = growth ~ concentration, tau = 0.5)
## 
## tau: [1] 0.5
## 
## Coefficients:
##               coefficients lower bd upper bd
## (Intercept)   -0.06011     -0.17742  0.02280
## concentration  2.06802      1.87514  2.23110</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="heteroskedasticity.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit, <span class="at">se =</span> <span class="st">&quot;boot&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Call: rq(formula = growth ~ concentration, tau = 0.5)
## 
## tau: [1] 0.5
## 
## Coefficients:
##               Value    Std. Error t value  Pr(&gt;|t|)
## (Intercept)   -0.06011  0.07352   -0.81757  0.41559
## concentration  2.06802  0.10989   18.81864  0.00000</code></pre>
<p>Alternative and very useful <code>quantreg</code>.{R} package:
<a href="https://cran.r-project.org/web/packages/lqmm/index.html" target="_blank" rel="noopener">https://cran.r-project.org/web/packages/lqmm/index.html</a></p>
<p><strong><em>Summary</em></strong></p>
<p>Actions on <strong>real outliers</strong>:</p>
<ul>
<li>Robust regression.</li>
<li>Remove</li>
</ul>
<p>Actions on <strong>different distributions</strong>:</p>
<ul>
<li>Transform.</li>
<li>Change distribution or quantile regression.</li>
</ul>
</div>
<div id="random-and-mixed-effects---motivation" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Random and Mixed Effects - Motivation<a href="heteroskedasticity.html#random-and-mixed-effects---motivation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Random effects are a very common addition to regression models that can be used for any type of grouping (categorical) variable. Lets look at the Month in airquality:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="heteroskedasticity.html#cb304-1" aria-hidden="true" tabindex="-1"></a>airquality<span class="sc">$</span>fMonth <span class="ot">=</span> <span class="fu">as.factor</span>(airquality<span class="sc">$</span>Month)</span></code></pre></div>
<p>Let’s say further that we are only interested in calculating the mean of Ozone:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="heteroskedasticity.html#cb305-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> airquality)</span></code></pre></div>
<p>Problem: If we fit residuals, we see that they are correlated in Month, so we somehow have to account for Month:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="heteroskedasticity.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(fit) <span class="sc">~</span> airquality<span class="sc">$</span>fMonth[<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(<span class="fu">model.frame</span>(fit)))])</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk22-1.png" width="672" /></p>
<p>A fixed effect model for fMonth would be</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="heteroskedasticity.html#cb307-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> fMonth, <span class="at">data =</span> airquality)</span>
<span id="cb307-2"><a href="heteroskedasticity.html#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ fMonth, data = airquality)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -52.115 -16.823  -7.282  13.125 108.038 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   23.615      5.759   4.101 7.87e-05 ***
## fMonth6        5.829     11.356   0.513    0.609    
## fMonth7       35.500      8.144   4.359 2.93e-05 ***
## fMonth8       36.346      8.144   4.463 1.95e-05 ***
## fMonth9        7.833      7.931   0.988    0.325    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 29.36 on 111 degrees of freedom
##   (37 observations deleted due to missingness)
## Multiple R-squared:  0.2352, Adjusted R-squared:  0.2077 
## F-statistic: 8.536 on 4 and 111 DF,  p-value: 4.827e-06</code></pre>
<p>However, using a fixed effect costs a lot of degrees of freedom, and maybe we are not really interested in Month, we just want to correct the correlation in the residuals.</p>
<p>Solution: <strong>Mixed / random effect models</strong>. In a mixed model, we assume (differently to a fixed effect model) that the effect of Month is coming from a normal distribution. In a way, you could say that there are two types of errors:</p>
<ul>
<li><p>The random effect, which is a normal “error” per group (in this case Month).</p></li>
<li><p>And the residual error, which comes on top of the random effect.</p></li>
</ul>
<p>Because of this hierarchical structure, these models are also called “multi-level models” or “hierarchical models”.
Nomenclature:</p>
<ul>
<li>No random effect = Fixed effect model.</li>
<li>Only random effects + intercept = Random effect model.</li>
<li>Random effects + fixed effects = Mixed model.</li>
</ul>
<p>Because grouping naturally occurs in any type of experimental data (batches, blocks, etc.), mixed effect models are the de-facto default for most experimental data! Mind, that grouping even occurs for example, when 2 different persons gather information.</p>
<div id="fitting-random-effects-models" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Fitting Random Effects Models<a href="heteroskedasticity.html#fitting-random-effects-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To speak about random effects, we will use an example data set containing exam scores of 4,059 students from 65 schools in Inner London. This data set is located in the R package <code>mlmRev</code>.{R}.</p>
<ul>
<li>Response: “normexam” (Normalized exam score).</li>
<li>Predictor 1: “standLRT” (Standardised LR test score; Reading test taken when they were 11 years old).</li>
<li>Predictor 2: “sex” of the student (F / M).</li>
</ul>
<p>If we analyze this with a simple lm, we get the following response:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="heteroskedasticity.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlmRev)</span>
<span id="cb309-2"><a href="heteroskedasticity.html#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb309-3"><a href="heteroskedasticity.html#cb309-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-4"><a href="heteroskedasticity.html#cb309-4" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">=</span> <span class="fu">lm</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex , <span class="at">data =</span> Exam)</span>
<span id="cb309-5"><a href="heteroskedasticity.html#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(mod0))</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk24-1.png" width="672" /></p>
<p><strong><em>Random intercept model</em></strong></p>
<p>A random intercept model assumes that each school gets their own intercept. It’s pretty much identical to the fixed effect model <code class="sourceCode r"><span class="fu">lm</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span> school)</code>, except that instead of giving each school a separate independent intercept, we assume that the school effects come from a common normal distribution.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="heteroskedasticity.html#cb310-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">lmer</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data =</span> Exam)</span>
<span id="cb310-2"><a href="heteroskedasticity.html#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: normexam ~ standLRT + sex + (1 | school)
##    Data: Exam
## 
## REML criterion at convergence: 9346.6
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7120 -0.6314  0.0166  0.6855  3.2735 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  school   (Intercept) 0.08986  0.2998  
##  Residual             0.56252  0.7500  
## Number of obs: 4059, groups:  school, 65
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  0.07639    0.04202   1.818
## standLRT     0.55947    0.01245  44.930
## sexM        -0.17136    0.03279  -5.226
## 
## Correlation of Fixed Effects:
##          (Intr) stnLRT
## standLRT -0.013       
## sexM     -0.337  0.061</code></pre>
<p>If we look at the outputs, we see that the effects of school are not explicitly mentioned, i.e. we fit an average over the schools. This is also because we treat the random effects as error rather than as estimates.</p>
<p>However, the school mean effects are estimated, and we can make them visible, e.g. via:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="heteroskedasticity.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Exam, {</span>
<span id="cb312-2"><a href="heteroskedasticity.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  randcoef <span class="ot">=</span> <span class="fu">ranef</span>(mod1)<span class="sc">$</span>school[,<span class="dv">1</span>]</span>
<span id="cb312-3"><a href="heteroskedasticity.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  fixedcoef <span class="ot">=</span> <span class="fu">fixef</span>(mod1)</span>
<span id="cb312-4"><a href="heteroskedasticity.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(standLRT, normexam)</span>
<span id="cb312-5"><a href="heteroskedasticity.html#cb312-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">65</span>){</span>
<span id="cb312-6"><a href="heteroskedasticity.html#cb312-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="at">a =</span> fixedcoef[<span class="dv">1</span>] <span class="sc">+</span> randcoef[i], <span class="at">b =</span> fixedcoef[<span class="dv">2</span>], <span class="at">col =</span> i)</span>
<span id="cb312-7"><a href="heteroskedasticity.html#cb312-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb312-8"><a href="heteroskedasticity.html#cb312-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk26-1.png" width="672" /></p>
<p><strong><em>Random slope model</em></strong></p>
<p>A random slope model assumes that each school also gets their own slope for a given parameter (per default we will always estimate slope and intercept, but you could overwrite this, not recommended!). Let’s do this for standLRT (you could of course do both as well).</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="heteroskedasticity.html#cb313-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">lmer</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span>  (standLRT <span class="sc">|</span> school), <span class="at">data =</span> Exam)</span>
<span id="cb313-2"><a href="heteroskedasticity.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: normexam ~ standLRT + sex + (standLRT | school)
##    Data: Exam
## 
## REML criterion at convergence: 9303.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8339 -0.6373  0.0245  0.6819  3.4500 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  school   (Intercept) 0.08795  0.2966       
##           standLRT    0.01514  0.1230   0.53
##  Residual             0.55019  0.7417       
## Number of obs: 4059, groups:  school, 65
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  0.06389    0.04167   1.533
## standLRT     0.55275    0.02016  27.420
## sexM        -0.17576    0.03228  -5.445
## 
## Correlation of Fixed Effects:
##          (Intr) stnLRT
## standLRT  0.356       
## sexM     -0.334  0.036</code></pre>
<p>Fitting a random slope on standLRT is pretty much identical to fit the fixed effect model<br />
<code class="sourceCode r"><span class="fu">lm</span>(normexam <span class="sc">~</span> standLRT<span class="sc">*</span>school <span class="sc">+</span> sex)</code>, except that school is a random effect, and therefore parameter estimates for the interaction sex:school are not independent. The results is similar to the random intercept model, except that we have an additional variance term.</p>
<p>Here a visualization of the results</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="heteroskedasticity.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Exam, {</span>
<span id="cb315-2"><a href="heteroskedasticity.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  randcoefI <span class="ot">=</span> <span class="fu">ranef</span>(mod2)<span class="sc">$</span>school[,<span class="dv">1</span>]</span>
<span id="cb315-3"><a href="heteroskedasticity.html#cb315-3" aria-hidden="true" tabindex="-1"></a>  randcoefS <span class="ot">=</span> <span class="fu">ranef</span>(mod2)<span class="sc">$</span>school[,<span class="dv">2</span>]</span>
<span id="cb315-4"><a href="heteroskedasticity.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  fixedcoef <span class="ot">=</span> <span class="fu">fixef</span>(mod2)</span>
<span id="cb315-5"><a href="heteroskedasticity.html#cb315-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(standLRT, normexam)</span>
<span id="cb315-6"><a href="heteroskedasticity.html#cb315-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">65</span>){</span>
<span id="cb315-7"><a href="heteroskedasticity.html#cb315-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="at">a =</span> fixedcoef[<span class="dv">1</span>] <span class="sc">+</span> randcoefI[i] , <span class="at">b =</span> fixedcoef[<span class="dv">2</span>] <span class="sc">+</span> randcoefS[i], <span class="at">col =</span> i)</span>
<span id="cb315-8"><a href="heteroskedasticity.html#cb315-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb315-9"><a href="heteroskedasticity.html#cb315-9" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="_main_files/figure-html/chunk_chapter4_chunk28-1.png" width="672" /></p>
<p><strong><em>Syntax cheat sheet:</em></strong></p>
<ul>
<li>Random intercept: `(1 | group).</li>
<li>ONLY random slope for a given fixed effect: <code class="sourceCode r">(<span class="dv">0</span> <span class="sc">+</span> fixedEffect <span class="sc">|</span> group)</code>.</li>
<li>Random slope + intercept + correlation (default): <code class="sourceCode r">(fixedEffect <span class="sc">|</span> group)</code>.</li>
<li>Random slope + intercept without correlation: <code class="sourceCode r">(fixedEffect <span class="sc">||</span> group)</code>, identical to<br />
<code class="sourceCode r">(<span class="dv">1</span> <span class="sc">|</span> group) <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> fixedEffect <span class="sc">|</span> group)</code>.</li>
<li>Nested random effects: <code class="sourceCode r">(<span class="dv">1</span> <span class="sc">|</span> group <span class="sc">/</span> subgroup)</code>. If groups are labeled A, B, C, … and subgroups 1, 2, 3, …, this will create labels A1, A2 ,B1, B2, so that you effectively group in subgroups. Useful for the many experimental people that do not label subgroups uniquely, but otherwise no statistical difference to a normal random effect.</li>
<li>Crossed random effects: You can add random effects independently, as in<br />
<code class="sourceCode r">(<span class="dv">1</span> <span class="sc">|</span> group1) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> group2)</code>.</li>
</ul>
</div>
<div id="problems-with-mixed-models" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Problems With Mixed Models<a href="heteroskedasticity.html#problems-with-mixed-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Specifying mixed models is quite simple, however, there is a large list of (partly quite complicate) issues in their practical application. Here, a (incomplete) list:</p>
<p><strong><em>Interpretation of random effects</em></strong></p>
<p>What do the random effects mean? The classical interpretation is that they are a structured error, so they are basically group residuals and are not of further importance. However, people increasingly see random effects also as a means to fit effects that could otherwise not be fittet. For example, if we have data for common and rare species, and we are interested in the density dependence of the species, we could fit</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="heteroskedasticity.html#cb316-1" aria-hidden="true" tabindex="-1"></a>mortality <span class="sc">~</span> density <span class="sc">+</span> (density <span class="sc">|</span> species)</span></code></pre></div>
<p>In such a model, we have the mean density effect across all species, and rare species with few data will be constrained by this effect, while common species with a lot of data can overrule the normal distribution imposed by the random slope and get their own estimate. In this picture, the random effect imposes an adaptive shrinkage, similar to a LASSO or ridge shrinkage estimator, with the shrinkage strength controlled by the standard deviation of the random effect.</p>
<p><strong><em>Degrees of freedom for a random effect</em></strong></p>
<p>The second problem is: How many parameters does a random effect model have? To know how many parameters the model hss is crucial for calculating p-values, AIC and all that. We can estimate roughly how many parameters we should have by looking at the fixed effect version of the models:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="heteroskedasticity.html#cb317-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">lm</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex , <span class="at">data =</span> Exam)</span>
<span id="cb317-2"><a href="heteroskedasticity.html#cb317-2" aria-hidden="true" tabindex="-1"></a>mod1<span class="sc">$</span>rank <span class="co"># 3 parameters.</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="heteroskedasticity.html#cb319-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">lmer</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data =</span> Exam)</span>
<span id="cb319-2"><a href="heteroskedasticity.html#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="co"># No idea how many parameters.</span></span>
<span id="cb319-3"><a href="heteroskedasticity.html#cb319-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-4"><a href="heteroskedasticity.html#cb319-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">lm</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span> school, <span class="at">data =</span> Exam)</span>
<span id="cb319-5"><a href="heteroskedasticity.html#cb319-5" aria-hidden="true" tabindex="-1"></a>mod3<span class="sc">$</span>rank <span class="co"># 67 parameters.</span></span></code></pre></div>
<pre><code>## [1] 67</code></pre>
<p>What we can say is that the mixed model is more complicated than mod1, but less than mod2 (as it has the additional constraint), so the complexity must be somewhere in-between. But now much?</p>
<p>In fact, the complexity is controlled by the estimated variance of the random effect. For a high variance, the model is nearly as complex as mod3, for a low variance, it is only as complex as mod1. Because of these issues, <code class="sourceCode r">lmer</code> by default does not return p-values. However, you can calculate p-values based on approximate degrees of freedom via the <code class="sourceCode r">lmerTest</code> package, which also corrects ANOVA for random effects, but not AIC.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="heteroskedasticity.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb321-2"><a href="heteroskedasticity.html#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="heteroskedasticity.html#cb321-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">=</span> <span class="fu">lmer</span>(normexam <span class="sc">~</span> standLRT <span class="sc">+</span> sex <span class="sc">+</span>  (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data =</span> Exam, <span class="at">REML =</span> F)</span>
<span id="cb321-4"><a href="heteroskedasticity.html#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
##   method [lmerModLmerTest]
## Formula: normexam ~ standLRT + sex + (1 | school)
##    Data: Exam
## 
##      AIC      BIC   logLik deviance df.resid 
##   9340.0   9371.6  -4665.0   9330.0     4054 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7117 -0.6326  0.0168  0.6865  3.2744 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  school   (Intercept) 0.08807  0.2968  
##  Residual             0.56226  0.7498  
## Number of obs: 4059, groups:  school, 65
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)    0.07646    0.04168   76.66670   1.834   0.0705 .  
## standLRT       0.55954    0.01245 4052.83930  44.950  &lt; 2e-16 ***
## sexM          -0.17138    0.03276 3032.37966  -5.231  1.8e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) stnLRT
## standLRT -0.013       
## sexM     -0.339  0.061</code></pre>
<p><strong><em>Variance partitioning / ANOVA</em></strong></p>
<p>Also variance partitioning is a bit tricky, as (see type I/II/III ANOVA discussion) fixed and random components of the model are in some way “correlated”. The question is: Do you want to count the random effect variance as “explained”, or “residual”. The most common approach is the hierarchical partitioning proposed by by <em>Nakagawa &amp; Schielzeth 2013, Nakagawa et al. (2017)</em>, which is implemented in the <code>MuMIn</code>.{R} package. With this, we can run</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="heteroskedasticity.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb323-2"><a href="heteroskedasticity.html#cb323-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-3"><a href="heteroskedasticity.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(m2) </span></code></pre></div>
<pre><code>##            R2m       R2c
## [1,] 0.3303846 0.4210712</code></pre>
<p>Interpretation</p>
<ul>
<li><strong>R2m</strong>: Marginal <span class="math inline">\({R}^{2}\)</span> value associated with fixed effects.</li>
<li><strong>R2c</strong>: Conditional <span class="math inline">\({R}^{2}\)</span> value associated with fixed effects plus the random effects.</li>
</ul>
</div>
</div>
<div id="case-studies-1" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Case studies<a href="heteroskedasticity.html#case-studies-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="case-study-1-college-student-performance-over-time" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Case Study 1: College Student Performance Over Time<a href="heteroskedasticity.html#case-study-1-college-student-performance-over-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong><em>Background and data structure</em></strong></p>
<p>The GPA (college grade point average) data is a <strong>longitudinal</strong> data set (also named <strong>panel data</strong>, German: “Längsschnittstudie”. A study repeated at several different moments in time, compared to a <strong>cross-sectional study</strong> (German: “Querschnittstudie”) which has several participants at <em>one time</em>). In this data set, 200 college students and their GPA have been followed 6 consecutive semesters. Look at the GPA data set, which can be found in the <code class="sourceCode r">EcoData</code> package:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="heteroskedasticity.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EcoData)</span>
<span id="cb325-2"><a href="heteroskedasticity.html#cb325-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-3"><a href="heteroskedasticity.html#cb325-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gpa)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1200 obs. of  10 variables:
##  $ student : Factor w/ 200 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 1 1 1 1 1 2 2 2 2 ...
##  $ occas   : Factor w/ 6 levels &quot;year 1 semester 1&quot;,..: 1 2 3 4 5 6 1 2 3 4 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;occasion&quot;
##  $ gpa     : num  2.3 2.1 3 3 3 3.3 2.2 2.5 2.6 2.6 ...
##  $ job     : Factor w/ 5 levels &quot;no job&quot;,&quot;1 hour&quot;,..: 3 3 3 3 3 3 3 4 3 3 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;job status&quot;
##  $ sex     : Factor w/ 2 levels &quot;male&quot;,&quot;female&quot;: 2 2 2 2 2 2 1 1 1 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;pupil gender&quot;
##  $ highgpa : num  2.8 2.8 2.8 2.8 2.8 2.8 2.5 2.5 2.5 2.5 ...
##  $ admitted: Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 2 2 2 2 2 1 1 1 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;admitted to university&quot;
##  $ year    : num  1 1 2 2 3 3 1 1 2 2 ...
##  $ semester: Factor w/ 2 levels &quot;1&quot;,&quot;2&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ occasion: num  0 1 2 3 4 5 0 1 2 3 ...</code></pre>
<p>In this data set, there are GPA measures on 6 consecutive <strong>occasions</strong>, with a <strong>job</strong> status variable (how many hours worked) for the same 6 occasions. There are two student-level explanatory variables: The <strong>sex</strong> (1 = male, 2 = female) and the high school <strong>gpa</strong>. There is also a dichotomous student-level outcome variable, which indicates whether a student has been <strong>admitted</strong> to the university of their choice. Since not every student applies to a university, this variable has many missing values. Each <strong>student</strong> and each <strong>year</strong> of observation have an id.</p>
  <hr/>
  <strong><span style="color: #0011AA; font-size:25px;">Task</span></strong><br/>
<p>Analyze if GPA improves over time (<strong>occasion</strong>)!</p>
<p>Hint: The amount and trend of GPA from one student are not independent. Do a standard linear regression and a mixed effects regression, including random intercept and slope for the grouping variable <strong>student</strong>. Compare the confidence intervals (Hint: <code class="sourceCode r">?confint</code>) and the coefficients (<code class="sourceCode r">?coef</code>) of the standard linear model and the mixed effects model. Look at the random effects estimates of the mixed effects model (hint: <code class="sourceCode r">?ranef</code>).</p>
<p>Advanced / optional:</p>
<ul>
<li>Look at a visualziation of the random slopes at:<br />
<a href="https://m-clark.github.io/mixed-models-with-R/random_slopes.html#visualization-of-effects" target="_blank" rel="noopener">https://m-clark.github.io/mixed-models-with-R/random_slopes.html#visualization-of-effects</a>.</li>
<li>Execute and understand the generative simulation of random slopes at:<br />
<a href="https://m-clark.github.io/mixed-models-with-R/random_slopes.html#exercises-for-random-slopes" target="_blank" rel="noopener">https://m-clark.github.io/mixed-models-with-R/random_slopes.html#exercises-for-random-slopes</a>.</li>
</ul>
  <details>
    <summary>
      <strong><span style="color: #0011AA; font-size:25px;">Solution</span></strong>
    </summary>
    <p>
    </p>
  </details>
  <br/><hr/>
</div>
<div id="case-study-2---honeybee-data" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Case Study 2 - Honeybee Data<a href="heteroskedasticity.html#case-study-2---honeybee-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
  <hr/>
  <strong><span style="color: #0011AA; font-size:25px;">Task</span></strong><br/>
<p>We use</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="heteroskedasticity.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EcoData)</span>
<span id="cb327-2"><a href="heteroskedasticity.html#cb327-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-3"><a href="heteroskedasticity.html#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bees)</span></code></pre></div>
<p>Perform the data analysis, according to the hypothesis above.</p>
  <details>
    <summary>
      <strong><span style="color: #0011AA; font-size:25px;">Solution</span></strong>
    </summary>
    <p>
    </p>
  </details>
  <br/><hr/>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="understanding_linear_regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="GLMMs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
